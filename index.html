<html>
<head>
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet" >
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css" integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/grids-responsive-min.css">
    <script src="https://unpkg.com/vue@2.6.12/dist/vue.min.js"></script>
    <script src="https://unpkg.com/vuejs-datepicker"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NearHear</title>
</head>
<body>
    <style scoped="">
        :root {
            --bg-color: #f5fcff;
            --bg-color-2: #d7eef8;
            --highlight-color: #00e3f6ff;
            --text-color:black;
            --text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            --bg-img: url(assets/nh_diag.svg);
            --top-h: 185px;
            --top-h-n: -185px;
        }
        [v-cloak] {display: none}
        #app { font-family: "Nunito", sans-serif !important; letter-spacing: initial !important; width:100%; letter-spacing: initial;}
        #app .vdp-datepicker__calendar { color: var(--text-color); }
        /* #app .pure-g { padding-bottom: 2em; padding-top: 2em; letter-spacing: initial; } */
        #app .pure-g [class *= "pure-u"] {  font-family: "Nunito", sans-serif !important; letter-spacing: initial; }
        #app .pure-g.new {padding-top: 1em;}
        #app .pure-g.end {padding-bottom:1em; }
        #app input, textarea, select { margin:.5em; }
        #app .filter-wrapper .pure-form label { float: left; text-overflow: ellipsis; max-width: 10em; min-width: 10em; white-space: nowrap; overflow: hidden; }
        #footer { font-style: italic; color: var(--bg-color-1); position: fixed;  bottom: 0; right: 0; background: var(bg-color-3); width: 100%; height: 1em; text-align: right; padding: .5em; font-size: .75em; }
        #main-nav { margin-top: 7% }
        #main-nav ul { float:right }
        #main-nav .pure-menu-link { font-size: 1.3em; }
        #nh-logo { position: absolute; max-width: 14em; left: 5%; top: 10px; }
        #tagline   { font-size: large; position: absolute; left: 5%; text-transform: uppercase;}
        #quick-nav {  font-size: x-large; position: fixed; right: 5%; top:35px }
        #quick-nav a {  text-decoration: none; text-transform: uppercase; font-weight: 200; color:var(--text-color) }
        #quick-nav a:hover { color:var(--highlight-color); transition-duration: 300ms; transition-property: all; transition-timing-function: cubic-bezier(0.23, 1, 0.320, 1); }
        #app .toggleFilter a { cursor: pointer; } 

        
        #top-nav { box-shadow: 0px 0px 30px #0d2a3d33; padding-top: .5em; border-bottom: solid 1px var(--highlight-color); position: fixed; width: 100%; height: 175px; background-color: var(--bg-color); z-index:10; }

        #main-content { padding-top: var(--top-h); }

        a.anchor {
            position:relative;
            top: var(--top-h-n);
        }
       
        body {
            background-color:var(--bg-color-1);
            color: var(--text-color);
        }        
        body .container {
            font-family: Nunito !important;
            font-weight: lighter;
            font-size: 1.2em;
        }
        h1 {
            font-size: 2.5em;
            font-weight: 200;
            clear:both;
        }
        h2 {
            font-size: 1.75em;
            font-weight: 200;
            clear:both;
        }
        p {     
            text-align: justify;
            line-height: 1.5em;
            padding-bottom: 1em;
        }
        a, a:active, a:visited {
            color: var(--highlight-color);
            font-weight: bold;
        }

        .light-bg {
            margin-top:2em;
            color: var(--text-color);
        }
        .dark-bg, .dark-bg-1 {
            background-color:var(--bg-color);
            color: var(--bg-color-1);
            

        }
        .dark-bg-1 { 
            background-color:var(--bg-color-2); 
        }
        .pure-button-primary {
            border-radius: 8px;
            text-shadow:var(--text-shadow);
            background-color:var(--highlight-color); 
            color:var(--text-color); 
        }
        .filter-wrapper { float:left; margin-right: 1em };
        /* .datepicker-wrap { padding-top: 1em; padding-left: 3em; } */
        ol { list-style: none; counter-reset: my-awesome-counter; }
        ol li { counter-increment: my-awesome-counter; list-style: none; text-indent: -1em; }
        ol li::before { content: counter(my-awesome-counter) ". "; color: var(--highlight-color); font-weight: bold; }
    
        @media screen and (max-width: 1450px) {
            #app h1 {font-size: 1.5em; letter-spacing: initial; }
            #tagline { display: none; width:0; height: 0; }
            #app input, textarea { max-width: 9em }
            #quick-nav { top: 155px; font-size: large; left: 30px;}
            #nh-logo { left: 30px;  }
            .pure-g > div > div.wrap { padding: 0 30px; }
            .pure-g > div > h1 { padding: 0 30px; }
        } 

        @media screen and (max-width: 578px) {
            #top-nav { height: 190px; }
        } 

        @keyframes ldio-ocss36wta5n-o {
            0%    { opacity: 1; transform: translate(0 0) }
           49.99% { opacity: 1; transform: translate(40px,0) }
           50%    { opacity: 0; transform: translate(40px,0) }
          100%    { opacity: 0; transform: translate(0,0) }
        }
        @keyframes ldio-ocss36wta5n {
            0% { transform: translate(0,0) }
           50% { transform: translate(40px,0) }
          100% { transform: translate(0,0) }
        }
        .ldio-ocss36wta5n div {
          position: absolute;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          top: 30px;
          left: 10px;
        }
        .ldio-ocss36wta5n div:nth-child(1) {
          background: var(--highlight-color);
          animation: ldio-ocss36wta5n 1s linear infinite;
          animation-delay: -0.5s;
        }
        .ldio-ocss36wta5n div:nth-child(2) {
          background: var(--highlight-color);
          animation: ldio-ocss36wta5n 1s linear infinite;
          animation-delay: 0s;
        }
        .ldio-ocss36wta5n div:nth-child(3) {
          background: var(--highlight-color);
          animation: ldio-ocss36wta5n-o 1s linear infinite;
          animation-delay: -0.5s;
        }
        .loadingio-spinner-dual-ball-ffelmax3riq {
          width: 58px;
          height: 58px;
          overflow: hidden;
          background: none;
        }
        .ldio-ocss36wta5n {
          width: 100%;
          height: 100%;
          position: relative;
          transform: translateZ(0) scale(0.58);
          backface-visibility: hidden;
          transform-origin: 0 0; /* see note above */
        }
        .ldio-ocss36wta5n div { box-sizing: content-box; }
        /* generated by https://loading.io/ */
    </style>
    <div id="app" class="container gu" v-cloak  >
        <div id="top-nav">
            <div class="pure-g dark-bg">
                <div class="pure-u-1 pure-u-md-1-3">
                    <div style="position: fixed; top:0px; display: block; width:100%; height: 200px; border-bottom: solid 1px var(--highlight-color-color); ">
                        <img id="nh-logo" src="./assets/nh.png" alt="NearHear"></img>
                    </div>
                    <div style="position: fixed; top: 155px; display: block; width:100%;">
                        <div id="tagline">Discover music online. See it nearby. </div>
                        <div id="quick-nav">
                            <a href="#build">Build Playlist</a> | 
                            <a href="#notify">Get Notified</a> | 
                            <a href="#about">About</a> | 
                            <a href="#donate">Donate</a> | 
                            <a href="#contact">Contact</a>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div id="main-content">
            <vue-section title="What is NearHear?">
                <P>NearHear allows you to create Spotify playlists of artists that perform in your area. </P>
            </vue-section>
            
            <vue-section title="How It Works &#128640;" is-dark=true>
                <ol>
                    <li>Authorize with Spotify</li>
                    <li>Pick a city and a time frame</li>
                    <li>Filter by your favorite venues and genres</li>
                    <li>Tell NearHear to create a custom playlist</li>
                    <li>Check Spotify for your new playlist</li>
                </ol>
                <p>That's it. When you log into Spotify, you should see a playlist with tracks custom tailored to your area.</p>
                <!-- <p>NearHear is all about supporting live music, so once you discover an artist you like, checkout the playlist's description to find out when and where they perform.</p> -->
            </vue-section>

            <vue-section title="Build a playlist" anchor="build" v-if="!loading">
                
                <!-- Spotify Auth -->
                <div>
                    <div v-if="authNone">
                        <H2>Authorize with Spotify &#128275;</H2>
                        <p>We will send you over to Spotify to login, and then Spotify will give us permission to push playlists to your account. We never see your credentials, just your Spotify user id so it's easy and secure.</p>
                    </div>
                    <div class="warning" v-if="authError">
                        <H2>Authorization Issue &#129320; </H2>
                        <H3>Oh no! Something went awry...</H3>
                        <p>Seems like there's a problem authenticating with Spotify. This may or may not be our fault. Would you contact us and let us know you had an issue? We will try our best to fix it.</p>
                    </div>
                    <div class="warning" v-if="authSuccess">
                        <H2>Spotify Authorization Success &#127821; </H2>
                        <p>We've validated you with Spotify. In the next step you'll build the playlist.</p>
                    </div>
                    <form class="pure-form" v-if="authNone || authError"> 
                        <fieldset>
                            <input type="button" value="Authorize" class="pure-button pure-button-primary"  v-on:click="authSpotify" />
                        </fieldset>
                    </form>
                </div>

                <!-- Set Filters -->
                <div v-if="showPickCity">
                    <H2>Pick a city</H2>
                    <p>Currently we only support a couple of cities, but more will show up in the future. Check out our mailing list to sign up, and show interest in bringing NearHear to your town.</p>
                    <form class="pure-form">
                        <fieldset >
                            <select v-model="playlist.city" v-on:change="onCitySelected" >
                                <option disabled="disabled" value="" selected="trues" >Select City</option>
                                <option v-for="city in playlist.opt.cities" v-bind:value="city" :selected="city === playlist.city">{{city}}</option>
                            </select>
                        </fieldset>
                    </form>
                </div>
                <div v-if="showPickDates">
                    <H2>Set your date range</H2>
                    <p>We will build the playist based on artists performing during this time frame in {{playlist.city}}.</p>
                    <form class="pure-form">
                        <fieldset >
                            <div class="datepicker-wrap">
                                <vuejs-datepicker 
                                    :value="playlist.startDate" 
                                    :disabled-dates="playlist.opt.disabledDates"
                                    name="startDate" 
                                    placeholder="Pick Start Date" 
                                    @selected="onStartDateSelected">
                                </vuejs-sdatepicker>
                            </div>
                            <div class="datepicker-wrap">
                                <vuejs-datepicker 
                                    :value="playlist.endDate" 
                                    :disabled-dates="playlist.opt.disabledDates"
                                    name="endDate" 
                                    placeholder="Pick End Date" 
                                    @selected="onEndDateSelected">
                                </vuejs-datepicker>
                            </div>
                            <p style="font-style: italic;">We hate to bring it up, but... due to covid-19, the show listings in the spring and summer of 2020 are very sparse. Picking dates prior to covid-19 will create a fuller playlist, and possibly take you back to better days. &#x1f334; </p>
                        </fieldset>
                    </form>
                </div>
                <div v-if="showPickFilters">
                    <h2>Apply Filters</h2>
                    <div class="filter-wrapper" v-if="playlist.opt.broadGenres.length > 0">
                        <h3>Genres</h3>
                        <div class="toggleFilter">
                            <a v-on:click="toggleFilter('broadGenres',true)">Check all</a>
                            &nbsp;&nbsp;|&nbsp;&nbsp;
                            <a v-on:click="toggleFilter('broadGenres',false)">Uncheck All</a>
                        </div>
                        <form class="pure-form">
                            <fieldset >
                                <label v-for="item in playlist.opt.broadGenres" v for="checkbox-radio-option-one" class="pure-checkbox">
                                    <input type="checkbox" name="broadGenres" :id="item" :value="item" v-model="playlist.broadGenres" v-on:change="onFilterChange" />{{item}}
                                </label>
                            </fieldset>
                        </form>
                    </div>
                    <div class="filter-wrapper" v-if="playlist.opt.venues.length > 0">
                        <h3>Venues</h3>
                        <div class="toggleFilter">
                            <a v-on:click="toggleFilter('venues',true)">Check all</a>
                            &nbsp;&nbsp;|&nbsp;&nbsp;
                            <a v-on:click="toggleFilter('venues',false)">Uncheck All</a>
                        </div>
                        <form class="pure-form">
                            <fieldset >
                                <label v-for="item in playlist.opt.venues" for="checkbox-radio-option-one" class="pure-checkbox">
                                    <input type="checkbox" name="venues" :id="item" :value="item" v-model="playlist.venues" v-on:change="onFilterChange" />{{item}}</label>
                            </fieldset>
                        </form>
                    </div>
                </div>
                <div v-if="showCreatePlaylist">
                    <H2>Almost there!</H2>
                    <p>All you gotta do now is press that Create Playlist button. &#128293; </p>
                    <form class="pure-form">
                        <fieldset >
                            <div   v-if="playlist.status === status_codes.SENDING" class="loadingio-spinner-dual-ball-ffelmax3riq"><div class="ldio-ocss36wta5n"><div></div><div></div><div></div></div></div>
                            <input v-if="playlist.status !== status_codes.SENDING" type="button" value="Create Playlist" v-on:click="createPlaylist" class="pure-button pure-button-primary" :disabled="playlist.status === status_codes.SUCCESS" />
                        </fieldset>
                    </form>
                </div>

                <!-- Outcomes -->
                <div v-if="playlist.status === status_codes.SUCCESS">
                    <H2>Congrats! You've made a NearHear playlist. </H2>
                    <p>Head to Spotify and listen to it.</p>
                </div>
                <div v-if="playlist.status === status_codes.NO_RESULT">
                    <H2>No dice 🎲 </H2>
                    <p>Your filters resulted in an empty playlist. Try expanding your filters or your date range, and try again.</p>
                </div>
                <div v-if="playlist.status === status_codes.FAILURE">
                    <H2>Oh no! That didn't work. :(</H2>
                    <p>Would you <a href="mailto:feedback@nearhear.app">contact us</a> and let us know you had an issue? We will try our best to fix it.</p>
                </div>

            </vue-section>
            
            <vue-section title="Be Notified &#128036;" anchor="notify" is-dark=true>
                <p>NearHear is currently in the works, but we will hopefully be launching more cities post-covid. Enter your email and city below to be notified when we launch in your town.</p>
                <form class="pure-form">
                    <fieldset >
                        <input type="text" id="Email" name="Email" placeholder="Your Email" v-model="notified.email" />
                        <input type="text" id="City" name="City" placeholder="Your City" v-model="notified.city"/>
                        <div v-if="notified.status == status_codes.SENDING" class="loadingio-spinner-dual-ball-ffelmax3riq"><div class="ldio-ocss36wta5n"><div></div><div></div><div></div></div></div>
                        <input v-if="notified.status != status_codes.SENDING" type="submit" value="Get Notified!" class="pure-button pure-button-primary" v-on:click="getNotified"  :disabled="notified.status == status_codes.SENDING || notified.status == status_codes.SUCCESS" />
                        <p v-if="notified.status === status_codes.SUCCESS">Thanks! We hope you'll hear from us again.</p>
                        <p v-if="notified.status === status_codes.FAILURE">Whoops, something has gone wrong :(<a href="mailto:feedback@nearhear.app">Please let us know.</a></p>
                    </fieldset>
                </form>
            </vue-section>
            
            <vue-section title="About Us" anchor="about">
                <p>I'm Liz.  I made NearHear because I love seeing live music but I'm terrible at keeping up with new music.  I would look at my favorite venues and then manually lookup the bands playing there on Spotify- it was not a great system.  So I decided to make NearHear.                  NearHear uses local music listings to create Spotify playlists with artists that have upcoming shows - from that little bar down the street to giant arena shows and everything in between.</p>
                <p>Build a playlist covering the upcoming week, month, whatever, listen to Spotify like normal, and bam, problem solved.  Problem in this case being 2 fold.  First- finding shows to go to.  By restricting playlists to artists with upcoming shows NearHear provides near-instant gratification.  Second - The Spotify rut is real.  Having a fresh playlist that isn't just a feedback loop helps uncover new favorites with fresh tunes all week.</p>
                <p>Unfortunately Covid has put a massive damper on things - while NearHear is ready to be released into society, we humans are not.  The whole idea of discovering music to go see live is temporarily out the window.  So for now I recommend we take this time to get acquainted with our local music scene - the artists that live here and play here every week, the bands that come through regularly, as well as those big-name acts.  I've added venue filtering so you can get to know the aesthetic of various places around town and genre filtering so you can zero in on what you like.  Just keep in mind that the goal of NearHear is to discover new things, so while I encourage you to take a fun deep-dive on known-favorites, be sure to create more open-ended playlists as well.  You can always skip/delete things you don't like, and you never know what will hit you just-so on any given day.  And when live music returns, use NearHear to find your next show.</p>
            </vue-section>

            <vue-section title="Donate &#127867;" anchor="donate" is-dark=true >
                <p>Send us some love and throw some money our way! Nearhear is currently free and in a perfect world the generousity of others would keep it this way forever!</p>
                <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" class="pure-form">
                    <input type="hidden" name="cmd" value="_donations" />
                    <input type="hidden" name="business" value="liz@nearhear.app" />
                    <input type="hidden" name="currency_code" value="USD" />
                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
                    <img alt="" style="margin-left:2em" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
                </form>
            </vue-section>

            <vue-section title="Contact Us &#128227;" anchor="contact">
                <p>Questions, comments, concerns, just want to be friends? Please don't be a stranger and reach out to us <a href="mailto:feedback@nearhear.app">feedback@nearhear.app</a>.</p>
            </vue-section>


        </div>
    </div>
    <div id="footer">Copyright 2020 Offline Development LLC</div>

    <script>
        let baseUrl = "${NEARHEAR_APP}"
        if (baseUrl.indexOf("NEARHEAR_APP") > 0) {
            baseUrl = "https://nearhear.app"
        }

        const headers = new Headers()
        const userIdCn = "spotify_user_id"
        const status_codes = {
            "NO_RESULT": -2,
            "FAILURE": -1,
            "NONE": 0,
            "SENDING": 1,
            "SUCCESS": 2
        }
        headers.append("Content-Type", "text/plain"); 

        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+ d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
          var name = cname + "=";
          var decodedCookie = decodeURIComponent(document.cookie);
          var ca = decodedCookie.split(';');
          for(var i = 0; i <ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
              c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
          return "";
        }

        function nhFetch(path, method, body) {
            const opts = {
                method: method,
                //credentials: 'include',
                headers: headers,
                redirect: "follow"
            }

            if (body) {
                opts.body = JSON.stringify(body)
            }

            return fetch(baseUrl + path, opts)
        }

        var vueSection = {
            props: ['title','isDark', 'anchor'],
            computed: {
                classObject: function() {
                    return {
                        'dark-bg-1': this.isDark
                    }
                }
            },
            template: `
            <div class="pure-g" v-bind:class="classObject">
                <div class="pure-u-1 pure-u-md-1-3">
                </div>
                <div class="pure-u-1 pure-u-md-1-3">
                    <a v-bind:id="anchor" class="anchor"></a>
                    <h1 v-if="title">{{title}}</h1>
                    <div class="wrap">
                    <slot></slot>
                    </div>
                </div>
            </div>
            `
        }

        var app = new Vue({
          el: '#app',
          components: {
            vuejsDatepicker,
            vueSection
          },
          data: {
            loading: true,
            tab: 'about',
            auth: {
                spotify: {
                    inOauthMode: undefined,
                    userid: undefined,
                    oauthUrl: undefined
                }
            },
            features: {
                filters: true,
                autoDateRange: true
            },
            playlist: {
                opt: {
                    platforms: ['spotify'],
                    disabledDates: {
                        to: new Date(), // Disable all dates up to specific date
                        from: new Date(), // Disable all dates after specific date
                    },
                    cities: [],
                    broadGenres: [],
                    spotifyGenres: [],
                    venues: []
                },
                startDate: new Date(),
                endDate: new Date(),
                city: '',
                broadGenres: [],
                spotifyGenres: [],
                venues: [],
                status: status_codes.NONE,
            },
            notified: {
                city: '',
                email: '',
                status: status_codes.NONE
            },
            status_codes: status_codes
          },
          mounted: function(){
            // check user id
            const params = new URLSearchParams(window.location.search)
            const userId = this.getUserIdFromCookie()
            if (userId) {
                this.auth.spotify.userid = userId
            }
                
            // Grab current cities
            nhFetch(
                `/media/getSupportedCities`,  
                "GET")
                .then(response => response.text())
                .then(result => {
                    this.playlist.opt.cities = JSON.parse(result)
                    this.loading = false
                })
                .catch(error => console.log('error', error));
          },
          computed: {
              authNone: function() {
                return this.auth.spotify.userid === undefined
              },
              authSuccess: function() {
                return this.auth.spotify.userid && this.auth.spotify.userid !== 'error'
              },
              authError: function() {
                return this.auth.spotify.userid === 'error'
              },
              citySuccess: function() {
                return !!this.playlist.city
              },
              dateSuccess: function() {
                return this.playlist.startDate !== undefined && this.playlist.endDate !== undefined
              },
              showPickCity: function() {
                return this.authSuccess
              },
              showPickDates: function() {
                return !!this.playlist.city
              },
              showPickFilters: function() {
                  return this.features.filters && (this.playlist.opt.broadGenres.length > 0 || this.playlist.opt.venues.length > 0)
              },
              showCreatePlaylist: function() {
                  return this.features.filters && this.playlist.city
              }
          },
          methods: {
            getUserIdFromCookie: function() {
                return getCookie(userIdCn) || new URLSearchParams(window.location.search).get("userid")
            },
            navigate: function (tab) {
                this.tab = tab
            },
            authSpotify: function () {
                let authEndPoint = `${baseUrl}/spotify/auth`
                if (this.auth.spotify.userid !== undefined) {
                    authEndPoint += `?userid=${this.auth.spotify.userid}`
                }
                window.location = authEndPoint
            },
            buildPath: function() {
                let path = window.location.pathname
                let query = '?'
                if (this.playlist.city)      query += `playlist_city=${this.playlist.city}&`
                if (this.playlist.startDate) query += `playlist_startDate=${this.playlist.startDate}&`
                if (this.playlist.endDate)   query += `playlist_endDate=${this.playlist.endDate}&`
                return path + query
            },
            onCitySelected: function(city) {
                if (!this.playlist.opt.cities) {
                    return
                }
                this.onFilterChange()

                if (this.features.autoDateRange) {
                    nhFetch("/media/getDateRange", "POST", { "city" : this.playlist.city })
                     .then(resp => resp.text())
                     .then(result => {
                        const json = JSON.parse(result)
                        const startDate = new Date(json.StartDate)
                        const endDate = new Date(json.EndDate)

                        this.playlist.opt.disabledDates.to = startDate
                        this.playlist.opt.disabledDates.from = endDate
                        this.playlist.startDate = new Date(endDate - 2 * 24 * 60 * 60 * 1e3)
                        this.playlist.endDate =  endDate
                        this.onDateChanged()
                    })
                }
            },
            onDateChanged() {
                const payload = {
                    startDate: this.playlist.startDate,
                    endDate: this.playlist.endDate,
                    city: this.playlist.city,
                    minShows: 0
                }
                if (this.features.filters) {
                    nhFetch("/media/getFilters", "POST", payload)
                     .then(resp => resp.text())
                     .then(result => {
                        const json = JSON.parse(result)
                        this.playlist.opt.broadGenres = [...json.BroadGenres]
                        this.playlist.opt.spotifyGenres = [...json.SpotifyGenres]
                        this.playlist.opt.venues = [...json.Venues]
                        this.playlist.venues = [...json.Venues]
                    })
                }
            },
            onStartDateSelected: function(date) {
                if (this.playlist.startDate !== date) {
                    this.onFilterChange()
                }

                if (this.playlist.startDate !== date) {
                    this.playlist.startDate = date
                    this.onDateChanged()
                }
            },
            onEndDateSelected: function(date) {
                if (this.playlist.endDate !== date) {
                    this.onFilterChange()
                }

                if (this.playlist.endDate != date) {
                    this.playlist.endDate = date
                    this.onDateChanged()
                }
            },
            onFilterChange() {
                this.playlist.status = status_codes.NONE
            },
            toggleFilter(name, checked) {
                this.playlist[name] = checked ? [...this.playlist.opt[name]] : []
                this.onFilterChange()
            },
            createPlaylist: function() {
                for (const platform of this.playlist.opt.platforms) {
                    const payload = {
                        "Platform": platform,
                        "UserId": this.auth[platform].userid,
                        "DeleteExisting":false,
                        "Filters": {
                            "City": this.playlist.city,
                            "StartDate": this.playlist.startDate,
                            "EndDate": this.playlist.endDate,
                            "Venues":this.playlist.venues,
                            "BroadGenres":this.playlist.broadGenres,
                            "SpotifyGenres":this.playlist.spotifyGenres
                        }
                    }
                    this.playlist.status = status_codes.SENDING
                    nhFetch("/spotify/buildFilteredPlaylist", "POST", payload)
                        .then(resp => resp.text())
                        .then(result => {
                            const json = JSON.parse(result)

                            if (json.Success && !json.PlaylistCreated) {
                                this.playlist.status = status_codes.NO_RESULT
                            }
                            else if (json.Success) {
                                this.playlist.status = status_codes.SUCCESS
                            }
                            else {
                                this.playlist.status = status_codes.FAILURE
                            }
                        })   
                        .catch(() => {
                            this.playlist.status = status_codes.FAILURE
                        })                 
                }
            },
            getNotified: function() {
                const payload = {
                    email: this.notified.email,
                    city: this.notified.city 
                }
            
                this.notified.status = status_codes.SENDING
                nhFetch("/nearhear/addContact", "POST", payload)
                    .then(resp => resp.text())
                    .then(result => {
                        this.notified.status = status_codes.SUCCESS
                    })
                    .catch(() => {
                        this.notified.status = status_codes.FAILURE
                    })
            }
          }
        })
    </script>
  </body>
</html>
